# QA Report — Lomito Platform — 2026-02-16

## Executive Summary

| Metric                          | Value                                                                                                                                            |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Total issues (deduplicated)** | **35** (5 P0, 8 P1, 12 P2, 10 P3)                                                                                                                |
| **User story pass rate**        | **1/6 passed, 1/6 partial, 4/6 failed/blocked**                                                                                                  |
| **Route coverage**              | **17/17 routes tested**                                                                                                                          |
| **Responsive compliance**       | **Partial** — 1440px mostly works; 1024px has navbar overflow + data gaps; 768px has auth instability; 375px largely untestable due to auth loss |
| **Design compliance score**     | **~62%** (Stitch vs live app)                                                                                                                    |

### Top 5 Critical Items to Fix Immediately

1. **Null coordinates crash** — `review-detail-panel.tsx:102`, `case-detail-panel.tsx:155`, and `location-picker.tsx:43` all crash on null/undefined location data. Blocks moderation, government case detail, and report flows. (QA-P0-001)
2. **No route-level access control** — Any authenticated user can navigate directly to `/government` and see all data. `/moderation` is only blocked by the crash bug. (QA-P0-002)
3. **Report flow crash on web** — `MapboxGL.StyleURL.Street` is undefined on web platform, blocking the entire report submission flow. (QA-P0-003)
4. **Auth redirect instability** — Stale tokens redirect public routes to login; direct URL navigation to `/auth/login` causes redirect loops; session lost on page reload. (QA-P0-004)
5. **Registration does not create profile row** — New users get `auth.users` row but no `profiles` row, breaking all profile-dependent features. (QA-P1-001)

---

## P0 — Blockers (Prevents Core User Flow)

### QA-P0-001: Null coordinates crash in detail panels

- **Affected Routes/Flows**: `/moderation`, `/government` (case click), `/report/new` (step 2)
- **Root Cause**: Three components access `location.coordinates[N]` without null-checking:
  - `/Users/elninja/Code/lomito/apps/mobile/components/moderation/review-detail-panel.tsx:102` — `caseData.location.coordinates[0]`
  - `/Users/elninja/Code/lomito/apps/mobile/components/government/case-detail-panel.tsx:155` — `location.coordinates[1].toFixed(5)`
  - `/Users/elninja/Code/lomito/apps/mobile/components/report/location-picker.tsx:43` — `MapboxGL.StyleURL.Street` (related but distinct; see QA-P0-003)
- **Repro Steps**: Navigate to `/moderation` as any user; or click any case row in `/government`.
- **Impact**: Moderation page is 100% unusable. Government portal cannot view any individual case. Report flow crashes at step 2. Blocks user stories US-2, US-5, US-6.
- **Suggested Fix**: Add optional chaining: `caseData?.location?.coordinates?.[0] ?? 0`. Conditionally render detail panels only when a case with valid location is selected.

### QA-P0-002: No route-level access control on `/government` and `/moderation`

- **Affected Routes/Flows**: `/government`, `/moderation`
- **Root Cause**: Role checks exist only in navbar visibility (`web-navbar.tsx:62-65`) and tab layout (`(tabs)/_layout.tsx:21-24`). Neither the screen files nor the layout performs access checks or redirects. Hiding a tab in Expo Router does NOT prevent direct URL navigation.
- **Repro Steps**: Log in as citizen (maria@example.com). Navigate to `http://localhost:8081/government` in the URL bar. Full government portal with all 30 cases, folios, urgency levels, and escalation data is visible.
- **Impact**: Any authenticated user can see all government-internal case data. Security vulnerability.
- **Suggested Fix**: Add role guard at the top of `moderation.tsx` and `government.tsx` — check `profile.role` and redirect unauthorized users. Or create a reusable `<RoleGuard requiredRoles={['government', 'admin']}>` wrapper.

### QA-P0-003: Report flow crash — MapboxGL.StyleURL.Street undefined on web

- **Affected Routes/Flows**: `/report/new` (step 2 — location picker)
- **Root Cause**: `/Users/elninja/Code/lomito/apps/mobile/components/report/location-picker.tsx:43` — `MapboxGL.StyleURL.Street` is undefined on web because `react-native-mapbox-gl` does not export `StyleURL` for the web platform.
- **Repro Steps**: Log in, click "Nuevo reporte", select a category and animal type, click "Siguiente" to advance to step 2.
- **Impact**: Citizens cannot submit any reports on the web platform. Core flow completely blocked. Blocks user story US-2.
- **Suggested Fix**: Use platform-conditional style URL: `Platform.OS === 'web' ? 'mapbox://styles/mapbox/streets-v12' : MapboxGL.StyleURL.Street`.

### QA-P0-004: Auth redirect instability (stale tokens + redirect loops)

- **Affected Routes/Flows**: All public routes (with stale tokens), `/auth/login` (direct URL), `/auth/register` (direct URL)
- **Root Cause**: `/Users/elninja/Code/lomito/apps/mobile/app/_layout.tsx:45-68` — auth guard triggers redirect during token refresh failure cycle. Session tokens in localStorage are cleared on full page reload.
- **Repro Steps**:
  1. Stale token: Log in, wait for session to expire, revisit `/`. Redirects to `/auth/login` instead of showing public landing.
  2. Redirect loop: Type `http://localhost:8081/auth/login` in URL bar. App redirects through `/about`, `/legal/privacy`, `/legal/terms`, `/impact` in a loop.
- **Impact**: Returning visitors with expired sessions cannot view any public content. Direct links to login page are broken. Affects all user stories that begin with login.
- **Suggested Fix**: Clear invalid tokens on auth error before redirecting. Ensure public routes never redirect based on auth state. Fix `_layout.tsx` auth guard to handle refresh token failures gracefully.

### QA-P0-005: Navbar "Nuevo reporte" button clipped at 1024px

- **Affected Routes/Flows**: All authenticated routes at 1024px viewport width
- **Root Cause**: Navbar does not collapse to hamburger menu at 1024px. All 7 nav items + profile avatar + CTA button exceed available width.
- **Repro Steps**: Log in at 1024x768 viewport. Observe right side of navbar.
- **Impact**: Users at common laptop resolution (1024px) cannot access the "Nuevo reporte" button or profile avatar. Core navigation broken at this breakpoint.
- **Suggested Fix**: Add hamburger menu collapse at <1280px, or reduce visible nav items at 1024px.

---

## P1 — Critical (Major Feature Broken)

### QA-P1-001: Registration does not create profile row

- **Affected Routes/Flows**: Registration flow, all profile-dependent features
- **Root Cause**: Missing database trigger or post-registration hook. `auth.users` row is created but `public.profiles` row is not.
- **Repro Steps**: Register a new user (testqa@example.com). Query `SELECT * FROM public.profiles WHERE id = '<new_user_id>'` — returns 0 rows.
- **Impact**: New users have no profile data. Profile page, dashboard, and all role-dependent features fail.
- **Suggested Fix**: Add a Supabase database trigger on `auth.users` INSERT to create a corresponding `profiles` row.

### QA-P1-002: Post-registration session shows wrong user

- **Affected Routes/Flows**: Registration -> first authenticated session
- **Root Cause**: After registering `testqa@example.com`, the app displayed the Dev Admin (DA) profile. Session/user resolution race condition.
- **Impact**: New users see another user's data after registration.

### QA-P1-003: Donation submit fails silently (Edge Function missing)

- **Affected Routes/Flows**: `/donate` (submit action)
- **Root Cause**: `create-donation` Edge Function returns 404 ("Function not found"). Not deployed to local Supabase instance.
- **Repro Steps**: Navigate to `/donate`, select amount/method, click submit. Button returns to idle state with no feedback.
- **Impact**: No donations can be processed. Blocks user story US-3.
- **Suggested Fix**: Deploy `create-donation` Edge Function. Add user-facing error message on failure.

### QA-P1-004: Analytics `track-event` Edge Function returns 401 (cross-cutting)

- **Affected Routes/Flows**: Every page load, all routes, all users
- **Root Cause**: `/functions/v1/track-event` requires authentication but is called for unauthenticated visitors.
- **Impact**: Zero analytics collected for unauthenticated users (majority of first-time visitors). Console error on every page load.
- **Suggested Fix**: Either allow anonymous tracking in the Edge Function or skip the call for unauthenticated users.

### QA-P1-005: `jurisdiction-boundaries` Edge Function returns 401

- **Affected Routes/Flows**: Map page, government portal map
- **Root Cause**: Edge Function auth configuration issue.
- **Impact**: Map boundary overlays do not render. Jurisdiction visualization broken.

### QA-P1-006: Donate page redirects unauthenticated users despite being in `publicRoutes`

- **Affected Routes/Flows**: `/donate` (unauthenticated)
- **Root Cause**: Listed in `publicRoutes` in `_layout.tsx` (line 51) but page component fetches dashboard stats or has its own auth requirement that triggers redirect.
- **Impact**: Potential donors who are not logged in cannot access the donation page.

### QA-P1-007: LandingFooter social icons have no click handlers

- **Affected Routes/Flows**: Landing page (`/`) footer
- **Root Cause**: `/Users/elninja/Code/lomito/apps/mobile/components/landing/landing-footer.tsx:128-157` — social icon buttons have `accessibilityRole="link"` but no `onPress` handler. The `PageFooter` component correctly links to social URLs.
- **Impact**: Social links on the most-visited page do nothing when clicked.
- **Suggested Fix**: Copy social URL handlers from `PageFooter` (`page-footer.tsx`) to `LandingFooter`.

### QA-P1-008: Landing page routing bug at 1024px

- **Affected Routes/Flows**: `/` (unauthenticated, 1024px viewport)
- **Root Cause**: Navigating to `/` at 1024px viewport width redirects to `/donate` instead of showing the landing page.
- **Impact**: Users at common laptop resolution see the wrong page.

---

## P2 — Major (Feature Partially Broken or Significant UX Issue)

### QA-P2-001: User identity inconsistency between routes

- **Affected Routes/Flows**: Map shows "Dev Admin" (DA), Profile shows "Maria Garcia Lopez" (MG)
- **Root Cause**: Session/user resolution race condition. App resolves different user profiles depending on which token is active.
- **Impact**: Confusing user experience; potential data leakage.

### QA-P2-002: Protected routes redirect to landing page instead of login

- **Affected Routes/Flows**: `/dashboard`, `/profile`, `/settings`, `/report/new`, `/moderation`, `/government`
- **Root Cause**: `_layout.tsx:56-57` uses `router.replace('/(public)')` instead of redirecting to `/auth/login`.
- **Impact**: Unauthenticated users see the landing page with no "please sign in" prompt.

### QA-P2-003: `/impact` not directly accessible by URL

- **Affected Routes/Flows**: `/impact`
- **Root Cause**: Impact page lives at `(public)/impact.tsx`. Expo Router does not expose route group paths in the URL bar.
- **Impact**: Footer and about page links to impact page may not resolve correctly.

### QA-P2-004: React key collisions on about/legal pages

- **Affected Routes/Flows**: `/about`, `/legal/*`
- **Root Cause**: "Encountered two children with the same key" — likely duplicate keys in roadmap items or contact links list rendering.
- **Impact**: React rendering errors; potential UI glitches.

### QA-P2-005: Login submit button labeled "Contrasena" instead of action verb

- **Affected Routes/Flows**: `/auth/login` (password tab)
- **Impact**: Confusing UX — button should say "Iniciar sesion" or "Entrar".

### QA-P2-006: Municipality picker causes navigation to `/map`

- **Affected Routes/Flows**: `/auth/register`
- **Root Cause**: Clicking municipality dropdown sometimes triggers navigation to `http://localhost:8081/map` ("Unmatched Route") instead of opening the picker dialog.
- **Impact**: Registration flow interrupted.

### QA-P2-007: Donate page shows skeleton-only at 768px

- **Affected Routes/Flows**: `/donate` at 768x1024
- **Root Cause**: Content never renders at tablet width. Possible responsive conditional rendering bug.
- **Impact**: Tablet users cannot use the donation page.

### QA-P2-008: Government data table empty at 1024px

- **Affected Routes/Flows**: `/government` at 1024x768
- **Root Cause**: Stats show "30 Casos Asignados" but table body has no rows. Data-loading or responsive rendering issue.
- **Impact**: Government users on smaller screens cannot see case data.

### QA-P2-009: Bottom tab bar label truncation at 768px

- **Affected Routes/Flows**: All authenticated routes at 768px
- **Root Cause**: 6-item tab bar too wide for viewport. Labels clipped ("Moderaci...", "Configur...").
- **Suggested Fix**: Use icon-only tabs at this breakpoint.

### QA-P2-010: Moderation/Government links disappear from navbar on Profile/Settings

- **Affected Routes/Flows**: `/profile`, `/settings`
- **Root Cause**: App appears to switch user context between navigations, losing moderator/admin role visibility.
- **Impact**: Moderators/admins cannot navigate to their tools from profile or settings pages.

### QA-P2-011: "Case not found" error text is hardcoded English

- **Affected Routes/Flows**: `/case/[id]` with invalid UUID
- **Root Cause**: Error message not using `t()` i18n key.
- **Impact**: Spanish-speaking users see English error text.

### QA-P2-012: Some government case folios show "00000000"

- **Affected Routes/Flows**: `/government` case table
- **Root Cause**: Cases without assigned folio numbers display placeholder zeros.
- **Impact**: Government users cannot identify cases by folio.

---

## P3 — Minor (Visual Polish, Copy Issues)

| ID        | Title                                             | Routes                                  | Notes                                                                |
| --------- | ------------------------------------------------- | --------------------------------------- | -------------------------------------------------------------------- |
| QA-P3-001 | Case descriptions in English on Spanish UI        | `/` (landing), `/` (map activity panel) | Seed data in English                                                 |
| QA-P3-002 | 7 placeholder footer links (`#`)                  | Landing footer                          | Blog (x2), FAQ, Voluntariado, ONGs aliadas, Casos de exito, Contacto |
| QA-P3-003 | Deprecated RN style prop warnings                 | All pages                               | `shadow*`, `textShadow*`, `pointerEvents`                            |
| QA-P3-004 | `Layout children must be of type Screen` warnings | All route transitions                   | Expo Router layout warning                                           |
| QA-P3-005 | No sign-out button in Settings main content       | `/settings`                             | Only available in avatar dropdown                                    |
| QA-P3-006 | Nested `<button>` HTML warning in sign-out modal  | `/settings`                             | `<button>` cannot be descendant of `<button>`                        |
| QA-P3-007 | Landing stats show 0 at 768px                     | `/` (landing, 768px)                    | Data fetching timing issue                                           |
| QA-P3-008 | Profile stats cards cut off at viewport fold      | `/profile` (1440px)                     | Needs scroll or layout adjustment                                    |
| QA-P3-009 | Map activity panel skeleton at 1024px             | `/` (map, 1024px)                       | Shows 0 HOY / 0 RESUELTOS / 0 CRITICOS                               |
| QA-P3-010 | Password field pre-filled on register page        | `/auth/register`                        | Likely Chrome autofill, not a default value                          |

---

## Route-by-Route Summary

| Route               | Renders               | Auth Guard                              | Footer        | Console Errors                 | Responsive (375/768/1024/1440) | Design Match |
| ------------------- | --------------------- | --------------------------------------- | ------------- | ------------------------------ | ------------------------------ | ------------ |
| `/` (landing)       | Yes                   | Public                                  | LandingFooter | track-event 401                | PASS/PASS/FAIL\*/PASS          | 55%          |
| `/about`            | Yes                   | Public                                  | PageFooter    | key collision, track-event 401 | PASS/PASS/PASS/PASS            | N/A          |
| `/legal/privacy`    | Yes                   | Public                                  | PageFooter    | track-event 401                | N/T/N/T/N/T/PASS               | N/A          |
| `/legal/terms`      | Yes                   | Public                                  | PageFooter    | track-event 401                | N/T/N/T/N/T/PASS               | N/A          |
| `/donate`           | Redirect              | Broken (redirects despite publicRoutes) | PageFooter    | dashboard stats error          | PASS/FAIL\*/PASS/PASS          | N/A          |
| `/auth/login`       | Yes                   | Public                                  | None          | track-event 401                | PASS/PASS/PASS/PASS            | N/A          |
| `/auth/register`    | Yes                   | Public                                  | None          | track-event 401                | PASS/PASS/PASS/PASS            | N/A          |
| `/` (map, auth)     | Yes                   | Auth OK                                 | None          | track-event 401                | AUTH\*/PASS/PASS/PASS          | 75%          |
| `/dashboard`        | Yes                   | Auth OK                                 | PageFooter    | track-event 401                | AUTH\*/PASS/PASS/PASS          | 55%          |
| `/profile`          | Yes                   | Auth OK                                 | PageFooter    | track-event 401                | AUTH\*/PASS/PASS/PASS          | 55%          |
| `/settings`         | Yes                   | Auth OK                                 | PageFooter    | track-event 401                | AUTH*/AUTH*/PASS/PASS          | N/A          |
| `/case/[id]`        | Yes                   | Auth OK                                 | PageFooter    | track-event 401                | AUTH*/AUTH*/PASS/REDIR         | 65%          |
| `/report/new`       | CRASH (step 2)        | Auth OK                                 | None          | MapboxGL crash                 | AUTH*/AUTH*/REDIR/PASS         | 60%          |
| `/moderation`       | CRASH                 | No guard                                | N/A (crash)   | null coords crash              | AUTH*/PASS/AUTH*/CRASH         | 60%          |
| `/government`       | Yes                   | **No guard**                            | PageFooter    | track-event 401                | AUTH\*/PASS/PARTIAL/PASS       | 60%          |
| `/authority/submit` | Yes                   | Auth OK                                 | PageFooter    | track-event 401                | N/T/N/T/N/T/PASS               | N/A          |
| `/impact`           | Not accessible by URL | N/A                                     | N/A           | N/A                            | N/A                            | 50%          |

_AUTH = auth session lost during testing; FAIL = content/routing issue; REDIR = unexpected redirect; N/T = not tested_

---

## Role Access Control Matrix

| Route                  | Citizen          | Moderator       | Government       | Admin          | Expected           |
| ---------------------- | ---------------- | --------------- | ---------------- | -------------- | ------------------ |
| `/` (map)              | PASS             | PASS            | PASS             | PASS           | All                |
| `/dashboard`           | PASS             | PASS            | PASS             | PASS           | All                |
| `/profile`             | PASS             | PASS            | PASS             | PASS           | All                |
| `/settings`            | PASS             | PASS            | PASS             | PASS           | All                |
| `/case/[id]`           | PASS             | PASS            | PASS             | PASS           | All                |
| `/report/new`          | CRASH (step 2)   | CRASH (step 2)  | CRASH (step 2)   | CRASH (step 2) | All (MapboxGL bug) |
| `/donate`              | PASS             | PASS            | PASS             | PASS           | All                |
| `/moderation`          | CRASH (no guard) | CRASH           | CRASH (no guard) | CRASH          | Mod+Admin only     |
| `/government`          | **FULL ACCESS**  | **FULL ACCESS** | PASS             | PASS           | Gov+Admin only     |
| `/authority/submit`    | PASS             | PASS            | PASS             | PASS           | All                |
| **Navbar: Moderacion** | Hidden           | Visible         | Hidden           | Visible        | Correct            |
| **Navbar: Gobierno**   | Hidden           | Hidden          | Visible          | Visible        | Correct            |

---

## User Story Results

| Story                        | Status      | Steps Completed | Blocking Issue                                                                                                 |
| ---------------------------- | ----------- | --------------- | -------------------------------------------------------------------------------------------------------------- |
| US-1: Registration           | **Partial** | 7/9             | Auth redirect loop (QA-P0-004), no profile row created (QA-P1-001), wrong user shown post-register (QA-P1-002) |
| US-2: Citizen Reports        | **Failed**  | 3/7             | LocationPicker crash at step 2 (QA-P0-003)                                                                     |
| US-3: Donor Flow             | **Partial** | 5/6             | `create-donation` Edge Function missing (QA-P1-003)                                                            |
| US-4: Settings & Preferences | **Passed**  | 6/6             | None                                                                                                           |
| US-5: Moderator Reviews      | **Failed**  | 1/5             | ReviewDetailPanel crash (QA-P0-001)                                                                            |
| US-6: Government Responds    | **Failed**  | 3/6             | CaseDetailPanel crash (QA-P0-001)                                                                              |

---

## Responsive Issues by Viewport

| Route       | 375px                  | 768px                   | 1024px                      | 1440px               |
| ----------- | ---------------------- | ----------------------- | --------------------------- | -------------------- |
| Landing     | PASS                   | PASS (stats show 0)     | FAIL (redirects to /donate) | PASS                 |
| Login       | PASS                   | PASS                    | PASS                        | PASS                 |
| About       | PASS                   | PASS                    | PASS (content cut short)    | PASS                 |
| Donate      | PASS                   | FAIL (skeleton only)    | PASS                        | PASS                 |
| Map         | Not tested (auth lost) | PASS                    | PASS (activity skeleton)    | PASS                 |
| Dashboard   | Not tested (auth lost) | PASS                    | PASS                        | PASS                 |
| Profile     | Not tested (auth lost) | PASS                    | PASS                        | PASS (stats cut off) |
| Settings    | Not tested (auth lost) | Not tested (auth lost)  | PASS                        | PASS                 |
| Report      | Not tested (auth lost) | Not tested (auth lost)  | Redirected to map           | PASS (step 1 only)   |
| Moderation  | Not tested (auth lost) | PASS (card layout)      | Not tested (auth lost)      | CRASH                |
| Government  | Not tested (auth lost) | PASS (card layout)      | PARTIAL (empty table)       | PASS                 |
| Case Detail | Not tested (auth lost) | Not tested (auth lost)  | PASS (case not found)       | Redirected to `/`    |
| **Navbar**  | Simplified (OK)        | Cramped (dual nav bars) | **Overflow (CTA clipped)**  | PASS                 |

---

## Design Compliance Summary

**Overall score: ~62%**

| Screen            | Score | Key Divergences                                                            |
| ----------------- | ----- | -------------------------------------------------------------------------- |
| Landing Page      | 55%   | No hero dog image, dark navy vs cream bg, different CTA styling            |
| Map Dashboard     | 75%   | Layout matches well; activity panel lacks thumbnails; extra map mode tabs  |
| Profile Dashboard | 55%   | Light vs dark theme; missing report card thumbnails; missing progress bars |
| Case Detail       | 65%   | Color accent differences; layout structure similar                         |
| Report Flow       | 60%   | 5 steps vs 3 in design; color accent mismatch                              |
| Government Portal | 60%   | Top navbar vs sidebar nav; missing detail flyout panel                     |
| Moderator Queue   | 60%   | Top navbar vs sidebar nav; missing credibility scores                      |
| Impact Dashboard  | 50%   | Only skeleton state observed                                               |

### Intentional Divergences (Not Bugs)

- **Color standardization**: Live app uses `#13ECC8` throughout; Stitch designs use inconsistent colors (`#20c997`, `#2D9CDB`, `#13b6ec`). Live app is correct per `DESIGN_TOKENS.md`.
- **Font**: Live app uses Public Sans; one Stitch project uses Montserrat. Live app is correct.
- **Top navbar vs sidebar navigation**: Consistent top navbar across all pages is a deliberate architectural choice.
- **Extra map features**: Points/Heat/Groups tabs, Show Boundaries toggle are feature additions beyond the original design.

### Design Bugs to Address

- Missing hero imagery on landing page (P2)
- Missing thumbnail images on profile report cards (P2)
- Missing case detail flyout panel in government portal (P2)

---

## Cross-Cutting Issues

### 1. Analytics `track-event` 401 (All routes, all users)

Every page load fires a request to `/functions/v1/track-event` that returns 401 Unauthorized. This means zero analytics are being collected. Reported by agents 1-6.

### 2. Auth Session Instability (Multiple routes)

Manifests in three ways:

- **Stale token redirects**: Expired refresh tokens cause public route redirects to `/auth/login`
- **Direct URL redirect loop**: Hard navigation to `/auth/login` cycles through public routes
- **Session loss on reload**: Tokens cleared from localStorage on full page reload

Reported by agents 1, 2, 4, 5, 6.

### 3. Deprecated React Native Web Style Props (All routes)

`shadow*`, `textShadow*`, `pointerEvents` deprecation warnings appear on every page load. Cosmetic but noisy. Reported by agents 1-5.

### 4. `Layout children must be of type Screen` (All route transitions)

Expo Router warns about non-Screen children in layout files on every navigation. Reported by agents 2-5.

### 5. Duplicate Key Warnings (Multiple routes)

"Encountered two children with the same key" errors appear on about page, legal pages, and during navigation. Reported by agents 1-3.

### 6. Edge Functions Not Deployed

`create-donation` (404), `track-event` (401), `jurisdiction-boundaries` (401) all fail. Either not deployed to local Supabase or missing auth configuration.

### 7. Two Incompatible Footer Components

`LandingFooter` and `PageFooter` have different structures, different link sets, and different social icon handling. Should be consolidated.

---

## Fix Task Queue (Priority Order)

### P0 — Must fix before launch

| #   | Task                                                               | Complexity | Files to Modify                                                                                | Dependencies |
| --- | ------------------------------------------------------------------ | ---------- | ---------------------------------------------------------------------------------------------- | ------------ |
| 1   | Add null-safe coordinate access in detail panels                   | S          | `components/moderation/review-detail-panel.tsx`, `components/government/case-detail-panel.tsx` | None         |
| 2   | Add route-level role guards on `/moderation` and `/government`     | S          | `apps/mobile/app/(tabs)/moderation.tsx`, `apps/mobile/app/(tabs)/government.tsx`               | None         |
| 3   | Fix MapboxGL.StyleURL.Street for web in LocationPicker             | S          | `components/report/location-picker.tsx`                                                        | None         |
| 4   | Fix auth redirect logic for stale tokens and direct URL navigation | M          | `apps/mobile/app/_layout.tsx`                                                                  | None         |
| 5   | Fix navbar overflow at 1024px (hamburger menu or item reduction)   | M          | `components/navigation/web-navbar.tsx`                                                         | None         |

### P1 — Fix in current sprint

| #   | Task                                                                              | Complexity | Files to Modify                         | Dependencies |
| --- | --------------------------------------------------------------------------------- | ---------- | --------------------------------------- | ------------ |
| 6   | Add database trigger for profile creation on registration                         | S          | `supabase/migrations/` (new migration)  | None         |
| 7   | Fix post-registration session resolution                                          | M          | Auth flow / session management          | #6           |
| 8   | Deploy/fix Edge Functions (create-donation, track-event, jurisdiction-boundaries) | M          | `supabase/functions/`                   | None         |
| 9   | Fix donate page auth redirect (public route but redirects)                        | S          | Donate page component or `_layout.tsx`  | #4           |
| 10  | Add social icon handlers to LandingFooter                                         | S          | `components/landing/landing-footer.tsx` | None         |
| 11  | Fix landing page routing at 1024px (redirects to /donate)                         | S          | `_layout.tsx` or routing logic          | #4           |

### P2 — Fix before beta

| #   | Task                                                               | Complexity | Files to Modify                     | Dependencies |
| --- | ------------------------------------------------------------------ | ---------- | ----------------------------------- | ------------ |
| 12  | Fix user identity inconsistency between routes                     | M          | Auth/session management             | #7           |
| 13  | Redirect unauthenticated users to `/auth/login` instead of landing | S          | `_layout.tsx`                       | #4           |
| 14  | Make `/impact` directly accessible by URL                          | S          | Route configuration                 | None         |
| 15  | Fix React key collisions on about/legal pages                      | S          | About page component                | None         |
| 16  | Fix login submit button label ("Contrasena" -> "Iniciar sesion")   | S          | Login form component + i18n files   | None         |
| 17  | Fix municipality picker navigation bug on register                 | S          | Register form component             | None         |
| 18  | Fix donate page rendering at 768px                                 | S          | Donate page responsive logic        | None         |
| 19  | Fix government table data at 1024px                                | S          | Government page responsive logic    | None         |
| 20  | Fix bottom tab bar label truncation at 768px                       | S          | Tab bar configuration               | None         |
| 21  | Fix Moderation/Government links disappearing on Profile/Settings   | S          | Navbar / profile context            | #12          |
| 22  | Internationalize "Case not found" error text                       | S          | Case detail component + i18n files  | None         |
| 23  | Fix government case folios showing "00000000"                      | S          | Folio assignment logic or seed data | None         |

### P3 — Fix when time permits

| #   | Task                                             | Complexity | Files to Modify             | Dependencies |
| --- | ------------------------------------------------ | ---------- | --------------------------- | ------------ |
| 24  | Translate seed data case descriptions to Spanish | S          | `supabase/seed/`            | None         |
| 25  | Remove or implement placeholder footer links     | S          | `landing-footer.tsx`        | None         |
| 26  | Fix deprecated RN style props                    | M          | Multiple components         | None         |
| 27  | Fix nested button HTML in sign-out modal         | S          | Settings sign-out component | None         |
| 28  | Add sign-out button to Settings main content     | S          | Settings page               | None         |
| 29  | Consolidate LandingFooter and PageFooter         | M          | Both footer components      | #10, #25     |

---

## Screenshots Index

### Public Routes (1440px)

| File                | Description                                  |
| ------------------- | -------------------------------------------- |
| `landing-1440.png`  | Landing page with hero, stats, map section   |
| `about-1440.png`    | About page (may show login due to redirect)  |
| `privacy-1440.png`  | Privacy policy page                          |
| `terms-1440.png`    | Terms of service page                        |
| `donate-1440.png`   | Donate page (may show login due to redirect) |
| `login-1440.png`    | Login page with magic link/password tabs     |
| `register-1440.png` | Registration form                            |

### Authenticated Routes (1440px)

| File                   | Description                                          |
| ---------------------- | ---------------------------------------------------- |
| `map-1440.png`         | Map dashboard with filters, clusters, activity panel |
| `dashboard-1440.png`   | Dashboard with stats, reports, neighborhood watch    |
| `profile-1440.png`     | User profile with impact metrics                     |
| `settings-1440.png`    | Settings with notifications, language                |
| `case-detail-1440.png` | Case detail with hero, stats, photos, comments       |
| `report-1440.png`      | Report step 1 category selection                     |
| `moderation-1440.png`  | Moderation page CRASH error overlay                  |
| `government-1440.png`  | Government portal with KPI cards, case table         |
| `authority-1440.png`   | Authority contact suggestion form                    |

### Role Access Control

| File                             | Description                                                  |
| -------------------------------- | ------------------------------------------------------------ |
| `navbar-citizen-1440.png`        | Citizen navbar (no Moderation/Government)                    |
| `navbar-moderator-1440.png`      | Moderator navbar (includes Moderation)                       |
| `navbar-government-1440.png`     | Government navbar (includes Government)                      |
| `navbar-admin-1440.png`          | Admin navbar (both Moderation and Government)                |
| `citizen-government-1440.png`    | Citizen accessing /government — FULL access (security bug)   |
| `citizen-moderation-1440.png`    | Citizen accessing /moderation — crash                        |
| `moderator-government-1440.png`  | Moderator accessing /government — FULL access (security bug) |
| `government-moderation-1440.png` | Government accessing /moderation — crash                     |

### User Story Screenshots

| File                                | Description                                |
| ----------------------------------- | ------------------------------------------ |
| `us1-landing-page.png`              | US-1: Landing page (logged in)             |
| `us1-landing-logged-out.png`        | US-1: Landing page (logged out)            |
| `us1-login-page.png`                | US-1: Login page                           |
| `us1-register-validation-error.png` | US-1: Phone validation error               |
| `us1-registered-logged-in.png`      | US-1: Post-registration (wrong user shown) |
| `us2-maria-logged-in.png`           | US-2: Map dashboard as Maria               |
| `us2-report-step1.png`              | US-2: Report step 1 categories             |
| `us2-report-step2-crash.png`        | US-2: LocationPicker crash                 |
| `us3-donate-page.png`               | US-3: Donation page with selections        |
| `us4-settings-page.png`             | US-4: Settings in Spanish                  |
| `us4-settings-english.png`          | US-4: Settings in English                  |
| `us4-signed-out.png`                | US-4: Landing after sign out               |
| `us5-moderation-crash.png`          | US-5: Moderation crash overlay             |
| `us6-government-portal.png`         | US-6: Government portal                    |
| `us6-case-detail-crash.png`         | US-6: Case detail crash                    |

### Responsive (by viewport)

| File                  | Description                              |
| --------------------- | ---------------------------------------- |
| `landing-375.png`     | Landing at 375px                         |
| `landing-768.png`     | Landing at 768px                         |
| `landing-1024.png`    | Landing at 1024px (shows donate page!)   |
| `map-768.png`         | Map at 768px (with tab bar)              |
| `map-1024.png`        | Map at 1024px                            |
| `dashboard-768.png`   | Dashboard at 768px                       |
| `dashboard-1024.png`  | Dashboard at 1024px                      |
| `profile-768.png`     | Profile at 768px                         |
| `profile-1024.png`    | Profile at 1024px                        |
| `government-768.png`  | Government at 768px (card layout)        |
| `government-1024.png` | Government at 1024px (empty table)       |
| `moderation-768.png`  | Moderation at 768px (card layout, works) |
| `donate-768.png`      | Donate at 768px (skeleton only)          |
| `login-375.png`       | Login at 375px                           |

### Design Comparison (Stitch vs Live)

| File                               | Description                        |
| ---------------------------------- | ---------------------------------- |
| `stitch-vs-live-landing-page.png`  | Live landing page (for comparison) |
| `stitch-vs-live-map-dashboard.png` | Live map dashboard                 |
| `stitch-vs-live-profile.png`       | Live profile page                  |
| `stitch-vs-live-login.png`         | Live login page                    |
| `stitch-vs-live-settings.png`      | Live settings page                 |
| `stitch-vs-live-government.png`    | Live government portal             |
| `stitch-design-landing-page.png`   | Stitch landing page design         |
| `stitch-design-map-dashboard.png`  | Stitch map dashboard design        |
| `stitch-design-profile.png`        | Stitch profile dashboard design    |

---

## Test Coverage Summary

| Metric                  | Coverage                                                                                  |
| ----------------------- | ----------------------------------------------------------------------------------------- |
| Routes tested           | 17/17                                                                                     |
| User stories tested     | 6/6                                                                                       |
| Roles tested            | 4/4 (citizen, moderator, government, admin)                                               |
| Viewports tested        | 4/4 (375, 768, 1024, 1440)                                                                |
| Stitch screens compared | 8/13 (5 untestable due to auth loss or image-only designs)                                |
| Auth flow variations    | SPA nav (works), direct URL (broken), stale token (broken)                                |
| Edge Functions tested   | 3 tested, all failing (track-event 401, jurisdiction-boundaries 401, create-donation 404) |
